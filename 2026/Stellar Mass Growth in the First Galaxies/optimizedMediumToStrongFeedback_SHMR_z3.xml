<?xml version="1.0" encoding="UTF-8"?>
<!-- Base parameters for baryonic model optimization. -->
<parameters>
  <formatVersion>2</formatVersion>
  <version>0.9.4</version>

  <!-- Include required parameters -->
  <xi:include href="parameters/reference/darkMatterParticleCDM.xml"       xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="parameters/reference/cosmology.xml"                   xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="parameters/reference/powerSpectrum.xml"               xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="parameters/reference/structureFormation.xml"          xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="parameters/reference/darkMatterHalosProfile.xml"      xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="parameters/reference/darkMatterHalosTidalHeating.xml" xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="parameters/reference/darkMatterHalosStructure.xml"    xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="parameters/reference/subhaloOrbits.xml"               xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>

  <!-- Set verbosity to standard level. -->
  <verbosityLevel value="working"/>

  <!-- Set up the tasks to perform. -->
  <task value="evolveForests">
    <!-- Evolve merger tree forests. -->
  </task>

  <!-- Set up work sharing. This controls which threads/processes will compute each tree:                                            -->
  <!-- * "FCFS" (first-come-first-served) uses a synchronized MPI counter such that the first available thread/process takes the
         next available tree. This is in principle the most efficient approach, except for communication overheads. We use a hybrid
         approach where MPI communication is limited (as much as possible) to a single thread per process.                           -->
  <!-- * "cyclic" - trees are distributed to threads/processes in a round-robin manner - this avoids any communication but the total
         time will be limited by the slowest threads/trees.                                                                          -->
  <!-- In general FCFS seems to perform much better.                                                                                 -->
  <evolveForestsWorkShare value="FCFS"/>

  <!-- Merger tree building options --> 
  <mergerTreeBuildMasses value="fixedMass">
    <massTree value="
		     1.0e10 1.778e10 3.162e10 5.623e10
		     1.0e11 1.778e11 3.162e11 5.623e11
		     1.0e12 1.778e12 3.162e12 5.623e12
		     1.0e13
		     "/>
    <treeCount  value="
		       64 64 64 64
		       64 64 64 64
		       64 64 64 64
		       64
		       " />
  </mergerTreeBuildMasses>

  <!-- Merger tree building options --> 
  <mergerTreeConstructor value="filter">
    <!-- Use a 'filter' constructor here. It will default to an 'always' filter (making it inactive), but this allows models to
         impose a filter if they wish to do so. -->
    <mergerTreeConstructor value="build">
      <redshiftBase value="2.75"/>
    </mergerTreeConstructor>
  </mergerTreeConstructor>
  <mergerTreeBuilder     value="cole2000">
    <!-- The Cole et al. (2000) merger tree building algorithm is used. The "interval stepping" optimization from Appendix A -->
    <!-- of Benson, Ludlow, & Cole (2019, MNRAS, 485, 5010; https://ui.adsabs.harvard.edu/abs/2019MNRAS.485.5010B) is used   -->
    <!-- to speed up tree building.                                                                                          -->
    <accretionLimit     value="  0.1"/>
    <mergeProbability   value="  0.1"/>
    <redshiftMaximum    value="100.0"/>
    <branchIntervalStep value="true" />
  </mergerTreeBuilder>
  <mergerTreeBranchingProbability value="parkinsonColeHelly">
    <G0                 value="+0.57"/>
    <gamma1             value="+0.38"/>
    <gamma2             value="-0.01"/>
    <accuracyFirstOrder value="+0.10"/>
  </mergerTreeBranchingProbability>

  <!-- Halo mass resolution -->
  <mergerTreeMassResolution value="scaled">
    <massResolutionFractional value="1.0e-5"/>
    <massResolutionMinimum value="2.43e+8"/>
  </mergerTreeMassResolution>
  
  <!-- Component selection -->
  <componentBasic value="standard"/>
  <componentBlackHole value="standard">
    <massSeed value="100.0000"/>
    <heatsHotHalo value="true"/>
    <efficiencyRadioMode value="0.345493749853055"/>
    <efficiencyWind value="  0.0024"/>
    <efficiencyWindScalesWithEfficiencyRadiative value="true"/>
    <bondiHoyleAccretionEnhancementHotHalo value="  6.0000"/>
    <bondiHoyleAccretionEnhancementSpheroid value="  5.0000"/>
    <bondiHoyleAccretionTemperatureSpheroid value="100.0000"/>
    <bondiHoyleAccretionHotModeOnly value="true"/>
  </componentBlackHole>
  <componentDarkMatterProfile value="scale"/>
  <componentDisk value="standard">
    <massDistributionDisk value="exponentialDisk">
      <dimensionless value="true"/>
    </massDistributionDisk>
  </componentDisk>
  <componentHotHalo value="standard">
    <fractionLossAngularMomentum value="0.3"/>
    <starveSatellites value="false"/>
    <efficiencyStrippingOutflow value="0.1"/>
    <trackStrippedGas value="true"/>
  </componentHotHalo>
  <componentSatellite value="orbiting"/>
  <componentSpheroid value="standard">
    <ratioAngularMomentumScaleRadius value="0.79"/> <!-- Ratio of radial moments, I_2/I_3, for Hernquist spheroid truncated at 3 times the scale radius -->
    <efficiencyEnergeticOutflow value="1.0e-2"/>
    <massDistributionSpheroid value="hernquist">
      <dimensionless value="true"/>
    </massDistributionSpheroid>
  </componentSpheroid>
  <componentSpin value="vector"/>
  
  <!-- Intergalactic background radiation -->
  <radiationFieldIntergalacticBackground value="intergalacticBackgroundFile">
    <fileName value="%DATASTATICPATH%/radiation/Cosmic_Background_Radiation_FG20.hdf5"/>
  </radiationFieldIntergalacticBackground>

  <!-- Halo accretion options -->
  <accretionHalo value="naozBarkana2007"/>
  <intergalacticMediumFilteringMass value="gnedin2000"/>
  <intergalacticMediumState value="metallicityAstraeusV">
    <intergalacticMediumState value="instantReionization">
      <electronScatteringOpticalDepth value="0.0633"/>
      <reionizationTemperature value="2.0e4"/>
      <presentDayTemperature value="1.0e3"/>
      <intergalacticMediumState value="recFast"/>
    </intergalacticMediumState>
  </intergalacticMediumState>

  <!-- Hot halo gas cooling model options -->
  <hotHaloMassDistribution value="betaProfile"/>
  <hotHaloTemperatureProfile value="virial"/>
  <hotHaloMassDistributionCoreRadius value="virialFraction">
    <coreRadiusOverVirialRadius value="0.0843432847268869"/>
  </hotHaloMassDistributionCoreRadius>
  <coolingSpecificAngularMomentum value="constantRotation">
    <sourceAngularMomentumSpecificMean value="hotGas"/>
    <sourceNormalizationRotation value="hotGas"/>
  </coolingSpecificAngularMomentum>
  <hotHaloOutflowReincorporation value="henriques2013">
    <gamma value="1.78334879849815"/>
    <delta1 value="1.20204618540067"/>
    <delta2 value="0.336302228003855"/>
  </hotHaloOutflowReincorporation>

  <coolingFunction value="summation">
    <coolingFunction value="atomicCIECloudy"/>
    <coolingFunction value="CMBCompton"/>
    <coolingFunction value="molecularHydrogenGalliPalla"/>
  </coolingFunction>

  <chemicalReactionRate value="hydrogenNetwork">
    <fast value="true"/>
    <includeSelfShielding value="true"/>
  </chemicalReactionRate>
  <chemicalsToTrack value="AtomicHydrogen AtomicHydrogenCation MolecularHydrogen Electron"/>

  <coolingRadius value="simple"/>
  <coolingRate value="multiplier">
    <multiplier value="0.936071889182466"/>
    <coolingRate value="whiteFrenk1991">
      <velocityCutOff value="10000"/>
    </coolingRate>
  </coolingRate>
  <coolingTime value="simple">
    <degreesOfFreedom value="3.0"/>
  </coolingTime>
  <coolingTimeAvailable value="whiteFrenk1991">
    <ageFactor value="0.209711770751722"/>
  </coolingTimeAvailable>

  <!-- Hot halo ram pressure stripping options -->
  <hotHaloRamPressureStripping value="font2008">
    <solverFailureIsFatal value="false"/>
  </hotHaloRamPressureStripping>
  <hotHaloRamPressureForce value="orbitalPosition"/>
  <hotHaloRamPressureTimescale value="ramPressureAcceleration"/>

  <!-- Galactic structure solver options -->
  <galacticStructureSolver value="equilibrium">
    <convergenceFailureIsFatal value="false"/>
  </galacticStructureSolver>
  <darkMatterProfile value="adiabaticGnedin2004">
    <A value="0.73"/>
    <omega value="0.70"/>
    <toleranceRelative value="1.00e-4"/>
  </darkMatterProfile>
  
  <!-- Star formation rate options -->
  <starFormationRateDisks value="intgrtdSurfaceDensity"/>
  <starFormationRateSurfaceDensityDisks value="blitz2006">
    <starFormationFrequencyNormalization value="9.34268499534342e-10"/>
    <assumeMonotonicSurfaceDensity value="true"/>
    <assumeExponentialDisk value="true"/>
    <useTabulation value="true"/>
  </starFormationRateSurfaceDensityDisks>
  <starFormationRateSpheroids value="timescale">
    <starFormationTimescale value="dynamicalTime">
      <efficiency value="1.000"/>
      <exponentVelocity value="2.000"/>
      <timescaleMinimum value="0.010"/>
    </starFormationTimescale>
  </starFormationRateSpheroids>

  <!-- Stellar populations options -->
  <stellarPopulationProperties value="instantaneous"/>
  <stellarPopulationSpectra value="FSPS"/>
  <stellarPopulationSelector value="fixed"/>

  <initialMassFunction value="chabrier2001"/>
  <stellarPopulation value="standard">
    <recycledFraction value="0.460"/>
    <metalYield value="0.035"/>
  </stellarPopulation>

  <!-- AGN feedback options -->
  <hotHaloExcessHeatDrivesOutflow value="true"/>
  
  <!-- Accretion disk properties -->
  <accretionDisks value="switched">
    <accretionRateThinDiskMaximum value="0.30"/>
    <accretionRateThinDiskMinimum value="0.01"/>
    <scaleADAFRadiativeEfficiency value="true"/>
    <accretionDisksShakuraSunyaev value="shakuraSunyaev"/>
    <accretionDisksADAF value="ADAF">
      <efficiencyRadiationType value="thinDisk"/>
      <adiabaticIndex value="1.444"/>
      <energyOption value="pureADAF"/>
      <efficiencyRadiation value="0.01"/>
      <viscosityOption value="fit"/>
    </accretionDisksADAF>
  </accretionDisks>

  <!-- Black hole options -->
  <blackHoleSeeds value="fixed">
    <mass value="100"/>
    <spin value="0"/>
  </blackHoleSeeds>
  <blackHoleBinaryMerger value="rezzolla2008"/>

  <!-- Galaxy merger options -->
  <mergerMassMovements value="simple">
    <destinationGasMinorMerger value="spheroid"/>
    <massRatioMajorMerger value="0.25"/>
  </mergerMassMovements>
  <mergerRemnantSize value="cole2000">
    <energyOrbital value="1"/>
  </mergerRemnantSize>
  
  <!-- Node evolution and physics -->
  <nodeOperator value="multi">
    <!-- Cosmological epoch -->
    <nodeOperator value="cosmicTime"/>
    <!-- DMO evolution -->
    <nodeOperator value="DMOInterpolate"/>
    <!-- Halo concentrations -->
    <nodeOperator value="darkMatterProfileScaleSet"/>
    <nodeOperator value="darkMatterProfileScaleInterpolate"/>
    <!-- Spins are computed using the angular momentum random walk model of Benson, Behrens, & Lu     -->
    <!-- (2020; MNRAS; 496; 3371; http://adsabs.harvard.edu/abs/2020MNRAS.496.3371B).                 -->
    <!-- The best fit-value for the mass exponent is taken from here                                  -->
    <!-- https://github.com/galacticusorg/galacticus/wiki/Constraints:-Halo-spins-and-concentrations. -->
    <!-- and is offset for fix to Keplerian orbit propagation                                         -->
    <nodeOperator value="haloAngularMomentumVitvitska2002">
      <exponentMass                    value="1.92527794238468"/>
      <angularMomentumVarianceSpecific value="0.0029"          />
    </nodeOperator>
    <nodeOperator value="haloAngularMomentumInterpolate"/>
    <!-- Subhalo hierarchy -->
    <!-- Allows for promotion of sub-sub-halos to become sub-halos etc. -->
    <nodeOperator value="subsubhaloPromotion"/>
    <!-- Subhalo orbits -->
    <!-- Apply all orbital physics to the evolution of subhalos. -->
    <nodeOperator value="satelliteOrbit"/>
    <nodeOperator value="satelliteDynamicalFriction"/>
    <nodeOperator value="satelliteTidalMassLoss"/>
    <nodeOperator value="satelliteTidalHeating"/>
    <nodeOperator value="satelliteMergingRadiusTrigger">
      <!-- Subhalos will be removed if they reach 1% of the virial radius of their host halo. -->
      <radiusVirialFraction value="0.01"/>
    </nodeOperator>
    <nodeOperator value="satelliteDestructionMassThreshold">
      <!-- Subhalos will be removed if they fall below the merger tree mass resolution limit. -->
      <massDestructionAbsolute value="=[mergerTreeMassResolution::massResolutionMinimum]   "/>
      <massDestructionMassTreeFraction value="=[mergerTreeMassResolution::massResolutionFractional]"/>
      <massDestructionMassInfallFraction value="0.0"/>
    </nodeOperator>
    <!-- CGM -->
    <nodeOperator value="CGMChemistry">
      <fractionTimescaleEquilibrium value="1.0e-3"/>
    </nodeOperator>
    <!-- Star formation -->
    <nodeOperator value="starFormationDisks"/>
    <nodeOperator value="starFormationSpheroids"/>
    <!--Stellar feedback outflows-->
    <nodeOperator value="stellarFeedbackDisks">
      <stellarFeedbackOutflows value="massLoadingLimit">
        <factorMassLoadingMaximum value="534.686576124102"/>
	<stellarFeedbackOutflows value="rateLimit">
          <timescaleOutflowFractionalMinimum value="0.01"/>
          <stellarFeedbackOutflows value="powerLawRedshiftScaling">
            <velocityCharacteristic value="150.0"/>
            <exponent value="3.0"/>
	    <exponentRedshift value="-0.115"/>
          </stellarFeedbackOutflows>
	</stellarFeedbackOutflows>
      </stellarFeedbackOutflows>
    </nodeOperator>
    <nodeOperator value="stellarFeedbackSpheroids">
      <stellarFeedbackOutflows value="massLoadingLimit">
        <factorMassLoadingMaximum value="465.132810048575"/>
	<stellarFeedbackOutflows value="rateLimit">
          <timescaleOutflowFractionalMinimum value="0.01"/>
          <stellarFeedbackOutflows value="powerLawRedshiftScaling">
            <velocityCharacteristic value="150.0"/>
            <exponent value="3.0"/>
	    <exponentRedshift value="-0.115"/>
          </stellarFeedbackOutflows>
	</stellarFeedbackOutflows>
      </stellarFeedbackOutflows>
    </nodeOperator>
    <!-- Bar instability in galactic disks -->
    <nodeOperator value="nodeFormationTimeMassFraction">
      <fractionMassFormation value="0.5"/>
    </nodeOperator>
    <!-- Black holes -->
    <nodeOperator value="blackHolesSeed"/>
   <!-- Meta-data -->
    <nodeOperator value="massAccretionHistory"/>
    <!-- <nodeOperator value="galaxyMajorMergerTime"/> -->
    <!-- <nodeOperator value="galaxyGasMajorMergerTime"> -->
    <!--   <ratioGasMajorMerger value="=[mergerMassMovements::massRatioMajorMerger]"/> -->
    <!-- </nodeOperator> -->
    <nodeOperator value="galaxyMergers"/>
  </nodeOperator>

  <!-- Merger tree evolution -->
  <mergerTreeEvolver value="standard">
    <!-- Standard merger tree evolver with parameters chosen to (somewhat) optimize the evolution. -->
    <timestepHostAbsolute value="1.00"/>
    <timestepHostRelative value="0.10"/>
    <fractionTimestepSatelliteMinimum value="0.75"/>
    <backtrackToSatellites value="true"/>
    <profileSteps value="false"/>
  </mergerTreeEvolver>
  <mergerTreeNodeEvolver value="standard">
    <!-- Standard node evolve with parameters chosen to (somewhat) optimize the evolution. -->
    <odeToleranceAbsolute value="1.0e-4"/>
    <odeToleranceRelative value="1.0e-4"/>
    <reuseODEStepSize value="false"/>
    <profileOdeEvolver value="false"/>
  </mergerTreeNodeEvolver>
  <mergerTreeEvolveTimestep value="multi">
    <!-- Standard time-stepping rules -->
    <mergerTreeEvolveTimestep value="simple">
      <timeStepAbsolute value="1.000"/>
      <timeStepRelative value="0.100"/>
    </mergerTreeEvolveTimestep>
    <mergerTreeEvolveTimestep value="satellite">
      <timeOffsetMaximumAbsolute value="0.010"/>
      <timeOffsetMaximumRelative value="0.001"/>
    </mergerTreeEvolveTimestep>
    <mergerTreeEvolveTimestep value="starFormationHistory"/>
    <mergerTreeEvolveTimestep value="satelliteDestruction">
      <!-- This timestep rule is required to ensure that subhalos are removed when they meet the destruction criteria. -->
    </mergerTreeEvolveTimestep>
    <mergerTreeEvolveTimestep value="hostTidalMassLoss">
      <!-- This timestep criterion makes sure that subsubhalos do not evolve too far ahead of their host subhalos when
           the host density and mass change rapidly due to tidal effects. It also limits the evolution time of subhalos
           to the time at which the hosts first becomes subhalos. -->
      <timeStepRelative value="0.1"/>
      <fractionTimestepMinimum value="0.1"/>
    </mergerTreeEvolveTimestep>
  </mergerTreeEvolveTimestep>

  <!-- Star formation history -->
  <starFormationHistory value="inSitu">
    <starFormationHistory value="adaptive">
      <countMetallicities value="0"/>
      <timeStepMinimum       value="0.01"/>
      <countTimeStepsMaximum value="1000"/>
    </starFormationHistory>
  </starFormationHistory>

  <!-- Output epochs -->
  <outputTimes value="list">
    <!-- Additional redshifts can be added to this list to generate more outputs. -->
    <redshifts value="2.75"/>
  </outputTimes>

  <!-- Outputs -->
  <nodePropertyExtractor value="multi">
    <nodePropertyExtractor value="nodeIndices"/>
    <nodePropertyExtractor value="indicesTree"/>
    <nodePropertyExtractor value="treeWeight"/>
    <nodePropertyExtractor value="massStellar"/>
    <!-- <nodePropertyExtractor value="galaxyMajorMergerTime"/> -->
    <!-- <nodePropertyExtractor value="galaxyGasMajorMergerTime"/> -->
    <nodePropertyExtractor value="galaxyMergers"/>
    <nodePropertyExtractor value="starFormationHistory">
      <component value="all"/>
    </nodePropertyExtractor>    
  </nodePropertyExtractor>

  <!-- Gravitational lensing -->
  <!-- Ignore lensing for now -->
  <gravitationalLensing value="null" />

  <!-- Analyses -->
  <mergerTreeOutputter value="standard">
    <galacticFilter value="haloIsolated"/>
  </mergerTreeOutputter>
  
  <!-- Output file -->
  <outputFileName value="galaxiesMediumToStrongFeedback_SHMR_z3_varFeedback.hdf5"/>

</parameters>
